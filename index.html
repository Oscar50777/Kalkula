<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç–∏ ‚Äî 4 —Ñ—Ä–µ–π–º–∞</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      margin: 0;
    }

    h2 {
      text-align: center;
    }

    .summary-buttons {
      text-align: center;
      margin-bottom: 20px;
    }

    .summary-buttons button {
      margin: 5px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }

    .summary-result {
      font-weight: bold;
      font-size: 18px;
      margin-top: 10px;
    }

    .client-request-block {
      margin-top: 15px;
      text-align: center;
    }

    .client-request {
      width: 80%;
      min-height: 100px;
      padding: 10px;
      font-size: 14px;
      resize: vertical;
    }

    .summary-description {
      font-size: 14px;
      margin-top: 20px;
      white-space: pre-wrap;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: center;
      vertical-align: top;
    }

    .frame-container {
      display: flex;
      flex-direction: column;
      gap: 8px;
      border: 2px solid;
      padding: 10px;
      height: 100%;
      border-radius: 8px;
      transition: border-color 0.3s ease;
    }

    /* –¶–≤–µ—Ç–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ—Ä–µ–π–º–∞ */
    .frame-container.frame-1 {
      background-color: #e8f4f8;
      border-color: #2196F3;
    }

    .frame-container.frame-2 {
      background-color: #f0f8e8;
      border-color: #4CAF50;
    }

    .frame-container.frame-3 {
      background-color: #fff3e0;
      border-color: #FF9800;
    }

    .frame-container.frame-4 {
      background-color: #fce4ec;
      border-color: #E91E63;
    }

    /* –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Ñ—Ä–µ–π–º–æ–≤ —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ —Ü–≤–µ—Ç–∞–º–∏ */
    .frame-container.frame-1 h4 {
      color: #1976D2;
      background-color: rgba(33, 150, 243, 0.1);
      padding: 8px;
      border-radius: 4px;
      margin: 0 0 10px 0;
    }

    .frame-container.frame-2 h4 {
      color: #388E3C;
      background-color: rgba(76, 175, 80, 0.1);
      padding: 8px;
      border-radius: 4px;
      margin: 0 0 10px 0;
    }

    .frame-container.frame-3 h4 {
      color: #F57C00;
      background-color: rgba(255, 152, 0, 0.1);
      padding: 8px;
      border-radius: 4px;
      margin: 0 0 10px 0;
    }

    .frame-container.frame-4 h4 {
      color: #C2185B;
      background-color: rgba(233, 30, 99, 0.1);
      padding: 8px;
      border-radius: 4px;
      margin: 0 0 10px 0;
    }

    /* –ê–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–∫–æ–≥–¥–∞ –ø–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ) */
    .frame-container.frame-1.active {
      border-color: #0D47A1;
      box-shadow: 0 2px 8px rgba(33, 150, 243, 0.3);
    }

    .frame-container.frame-2.active {
      border-color: #1B5E20;
      box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
    }

    .frame-container.frame-3.active {
      border-color: #E65100;
      box-shadow: 0 2px 8px rgba(255, 152, 0, 0.3);
    }

    .frame-container.frame-4.active {
      border-color: #880E4F;
      box-shadow: 0 2px 8px rgba(233, 30, 99, 0.3);
    }

    iframe {
      width: 100%;
      height: 70vh;
      min-height: 650px;
      border: 1px solid #ccc;
      background-color: #fff;
      overflow: auto;
      border-radius: 4px;
    }

    /* –ú–µ–¥–∏–∞-–∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç–∏ */
    @media (max-width: 1200px) {
      iframe {
        min-height: 500px;
      }
    }

    @media (max-width: 768px) {
      table {
        display: block;
      }
      
      tr {
        display: block;
        margin-bottom: 20px;
      }
      
      td {
        display: block;
        width: 100%;
        margin-bottom: 10px;
      }
      
      iframe {
        height: 50vh;
        min-height: 400px;
      }
    }
  </style>
</head>
<body>

<h2>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç–∏ ‚Äî 4 —ç–∫–∑–µ–º–ø–ª—è—Ä–∞</h2>

<!-- –ë–ª–æ–∫ –∫–Ω–æ–ø–æ–∫ –∏ –≤—ã–≤–æ–¥–∞ -->
<div class="summary-buttons">
  <button onclick="sumPrices([0, 1])">–°—É–º–º–∞ 1+2</button>
  <button onclick="sumPrices([0, 1, 2])">–°—É–º–º–∞ 1+2+3</button>
  <button onclick="sumPrices([0, 1, 2, 3])">–°—É–º–º–∞ 1+2+3+4</button>
  <button onclick="copyAllToClipboard()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ</button>
  <div class="summary-result">–ò—Ç–æ–≥–æ: <span id="totalSum">0</span> —Ä—É–±.</div>
</div>

<!-- –ü–æ–ª–µ "–ó–∞–ø—Ä–æ—Å –∫–ª–∏–µ–Ω—Ç–∞" -->
<div class="client-request-block">
  <label for="clientRequestInput"><strong>–ó–∞–ø—Ä–æ—Å –∫–ª–∏–µ–Ω—Ç–∞:</strong></label><br>
  <textarea id="clientRequestInput" class="client-request" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –∫–ª–∏–µ–Ω—Ç–∞..."></textarea>
</div>

<!-- –ë–ª–æ–∫ –æ–ø–∏—Å–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
<div class="summary-description" id="summaryDescription"></div>

<!-- –¢–∞–±–ª–∏—Ü–∞ —Å iframe -->
<table>
  <tr>
    <td>
      <div class="frame-container frame-1">
        <h4>üîµ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä 1</h4>
        <iframe src="calculator.html" title="–§—Ä–µ–π–º 1"></iframe>
      </div>
    </td>
    <td>
      <div class="frame-container frame-2">
        <h4>üü¢ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä 2</h4>
        <iframe src="calculator.html" title="–§—Ä–µ–π–º 2"></iframe>
      </div>
    </td>
  </tr>
  <tr>
    <td>
      <div class="frame-container frame-3">
        <h4>üü† –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä 3</h4>
        <iframe src="calculator.html" title="–§—Ä–µ–π–º 3"></iframe>
      </div>
    </td>
    <td>
      <div class="frame-container frame-4">
        <h4>üî¥ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä 4</h4>
        <iframe src="calculator.html" title="–§—Ä–µ–π–º 4"></iframe>
      </div>
    </td>
  </tr>
</table>

<script>
  const frames = window.frames;
  const priceData = [null, null, null, null];
  const productInfo = ['', '', '', ''];

  // –°–ª—É—à–∞—Ç–µ–ª—å —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç iframe
  window.addEventListener("message", function(event) {
    if (event.data && event.data.type === "lastPrice") {
      const iframeIndex = Array.from(frames).indexOf(event.source);
      if (iframeIndex >= 0) {
        priceData[iframeIndex] = event.data.price;
        productInfo[iframeIndex] = event.data.description || '';
        
        // –í–∏–∑—É–∞–ª—å–Ω–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
        const frameContainer = document.querySelectorAll('.frame-container')[iframeIndex];
        if (frameContainer) {
          frameContainer.classList.add('active');
        }
      }
    }
  });

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–¥—Å—á—ë—Ç–∞ —Å—É–º–º—ã –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö iframe
  function sumPrices(indices) {
    let total = 0;
    let description = '';
    const clientRequest = document.getElementById('clientRequestInput').value.trim();

    indices.forEach((i) => {
      if (priceData[i] !== null) {
        total += priceData[i];
        description += `–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä ${i + 1}:\n`;
        description += `${productInfo[i]}\n\n`;
      } else {
        description += `–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä ${i + 1}: –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö\n\n`;
      }
    });

    // –í—ã–≤–æ–¥ –∏—Ç–æ–≥–∞
    document.getElementById("totalSum").textContent = total.toFixed(2);

    // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –∫–ª–∏–µ–Ω—Ç–∞ –∫ –æ–ø–∏—Å–∞–Ω–∏—é
    let fullDescription = '';
    if (clientRequest) {
      fullDescription += `–ó–∞–ø—Ä–æ—Å –∫–ª–∏–µ–Ω—Ç–∞:\n${clientRequest}\n\n`;
    }

    fullDescription += description;
    fullDescription += `–ò—Ç–æ–≥–æ: ${total.toFixed(2)} —Ä—É–±.`;

    document.getElementById("summaryDescription").textContent = fullDescription;
  }

  // –§—É–Ω–∫—Ü–∏—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
  function copyAllToClipboard() {
    const description = document.getElementById("summaryDescription").textContent;
    if (description) {
      navigator.clipboard.writeText(description).then(() => {
        alert("‚úÖ –î–∞–Ω–Ω—ã–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!");
      }).catch(() => {
        alert("‚ùå –û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è");
      });
    } else {
      alert("‚ö†Ô∏è –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è");
    }
  }

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è iframe
  function refreshAllFrames() {
    const iframes = document.querySelectorAll('iframe');
    iframes.forEach(iframe => {
      iframe.src = iframe.src;
    });
  }

  // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
  setInterval(() => {
    console.log('Price data:', priceData);
    console.log('Product info:', productInfo);
  }, 5000);
</script>

</body>
</html>
