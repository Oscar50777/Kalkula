<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Калькулятор себестоимости — 4 фрейма</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }

    h2 {
      text-align: center;
    }

    .summary-buttons {
      text-align: center;
      margin-bottom: 20px;
    }

    .summary-buttons button {
      margin: 5px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }

    .summary-result {
      font-weight: bold;
      font-size: 18px;
      margin-top: 10px;
    }

    .client-request-block {
      margin-top: 15px;
      text-align: center;
    }

    .client-request {
      width: 80%;
      min-height: 100px;
      padding: 10px;
      font-size: 14px;
      resize: vertical; /* Возможность растягивать по вертикали */
    }

    .summary-description {
      font-size: 14px;
      margin-top: 20px;
      white-space: pre-wrap;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    td {
      border: none;
      padding: 10px;
      text-align: center;
    }

    .frame-container {
      display: flex;
      flex-direction: column;
      gap: 8px;
      border: 1px solid #ccc;
      padding: 10px;
      background-color: #f9f9f9;
    }

    iframe {
      width: 100%;
      height: 400px;
      border: none;
      background-color: #fff;
    }
  </style>
</head>
<body>

<h2>Калькулятор себестоимости — 4 экземпляра</h2>

<!-- Блок кнопок и вывода -->
<div class="summary-buttons">
  <button onclick="sumPrices([0, 1])">Сумма 1+2</button>
  <button onclick="sumPrices([0, 1, 2])">Сумма 1+2+3</button>
  <button onclick="sumPrices([0, 1, 2, 3])">Сумма 1+2+3+4</button>
  <div class="summary-result">Итого: <span id="totalSum">0</span> руб.</div>
</div>

<!-- Поле "Запрос клиента" -->
<div class="client-request-block">
  <label for="clientRequestInput"><strong>Запрос клиента:</strong></label><br>
  <textarea id="clientRequestInput" class="client-request" placeholder="Введите запрос клиента..."></textarea>
</div>

<!-- Блок описания результатов -->
<div class="summary-description" id="summaryDescription"></div>

<!-- Таблица с iframe -->
<table>
  <tr>
    <td><iframe src="calculator.html" title="Фрейм 1"></iframe></td>
    <td><iframe src="calculator.html" title="Фрейм 2"></iframe></td>
  </tr>
  <tr>
    <td><iframe src="calculator.html" title="Фрейм 3"></iframe></td>
    <td><iframe src="calculator.html" title="Фрейм 4"></iframe></td>
  </tr>
</table>

<script>
  const frames = window.frames; // Все iframe на странице
  const priceData = [null, null, null, null]; // Хранилище цен по индексам
  const productInfo = ['', '', '', '']; // Хранение описания

  // Слушатель сообщений от iframe
  window.addEventListener("message", function(event) {
    if (event.data && event.data.type === "lastPrice") {
      const iframeIndex = Array.from(frames).indexOf(event.source);
      if (iframeIndex >= 0) {
        priceData[iframeIndex] = event.data.price;
        productInfo[iframeIndex] = event.data.description || '';
      }
    }
  });

  // Функция для подсчёта суммы выбранных iframe
  function sumPrices(indices) {
    let total = 0;
    let description = '';
    const clientRequest = document.getElementById('clientRequestInput').value.trim();

    indices.forEach((i) => {
      if (priceData[i] !== null) {
        total += priceData[i];
        description += `Фрейм ${i + 1}:\n`;
        description += `${productInfo[i]}\n\n`;
      }
    });

    // Вывод итога
    document.getElementById("totalSum").textContent = total.toFixed(2);

    // Добавляем запрос клиента к описанию
    let fullDescription = '';
    if (clientRequest) {
      fullDescription += `Запрос клиента:\n${clientRequest}\n\n`;
    }

    fullDescription += description;
    fullDescription += `Итого: ${total.toFixed(2)} руб.`;

    document.getElementById("summaryDescription").textContent = fullDescription;
  }
</script>

</body>
</html>
